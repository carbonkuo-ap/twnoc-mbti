# MBTI 測驗應用程式 - 安全性文件

## 概述

此 MBTI 測驗應用程式實作了多層次的安全機制，專為靜態網站部署（GitHub Pages）設計，提供安全防護。

## 已實作的安全功能

### 🔐 認證與授權

- **PBKDF2 密碼雜湊**：使用 10,000 次迭代與隨機 Salt
- **雙因素認證 (2FA)**：TOTP 支援 Google Authenticator
- **備用恢復碼**：10 組 8 位數字備用碼，單次使用
- **會話指紋識別**：結合瀏覽器特徵的安全驗證

### 🛡️ 登入防護

- **速率限制**：3 次失敗顯示 CAPTCHA，5 次失敗鎖定 15 分鐘
- **數學驗證碼**：防止自動化攻擊
- **漸進式延遲**：失敗次數越多，延遲時間越長
- **自動鎖定機制**：帳號暫時鎖定與自動解鎖

### 🔒 資料加密

- **AES-256-CTR + HMAC**：等同於 AES-GCM 的 authenticated encryption
- **PBKDF2 密鑰派生**：每次加密使用不同的 Salt 和 IV
- **向後相容**：支援舊格式資料的安全升級
- **完整性驗證**：HMAC-SHA256 防止資料篡改

### 📊 審計與監控

- **加密審計日誌**：所有安全事件的加密記錄
- **自動日誌清理**：最多保留 10,000 條記錄
- **統計分析**：成功率、失敗事件、活動趨勢
- **匯出功能**：管理員可匯出審計記錄

### 🚨 會話安全

- **自動超時**：15 分鐘無活動自動登出
- **指紋驗證**：檢測會話劫持嘗試
- **CSRF 防護**：隨機令牌防止跨站請求偽造
- **安全標頭**：適當的 HTTP 安全標頭設定

### 🔧 程式碼保護

- **WebPack 混淆**：生產環境程式碼混淆
- **除錯保護**：防止開發者工具分析
- **字串加密**：敏感字串的 Base64 編碼
- **控制流混淆**：增加程式碼分析難度

## 環境變數設定

### 必要變數

```bash
# 主加密密鑰（64 字元隨機字串）
NEXT_PUBLIC_ENCRYPTION_KEY=your-64-character-encryption-key

# 管理員密碼雜湊（PBKDF2）
NEXT_PUBLIC_ADMIN_HASH=your-admin-password-hash

# 密碼雜湊 Salt（32 字元隨機字串）
NEXT_PUBLIC_ADMIN_SALT=your-32-character-salt
```

### 生成安全密鑰

1. **加密密鑰**（64 字元）：

   ```bash
   node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
   ```

2. **Salt 值**（32 字元）：

   ```bash
   node -e "console.log(require('crypto').randomBytes(16).toString('hex'))"
   ```

3. **密碼雜湊**：
   ```javascript
   // 在瀏覽器控制台或 Node.js 中執行
   const { hashPassword } = require("./lib/security");
   const hash = hashPassword("your-password", "your-salt", 10000);
   console.log(hash);
   ```

## GitHub Secrets 配置

在 GitHub 儲存庫的 Settings > Secrets and Variables > Actions 中設定：

| Secret 名稱      | 描述           | 範例                        |
| ---------------- | -------------- | --------------------------- |
| `ENCRYPTION_KEY` | 主加密密鑰     | `a1b2c3d4e5f6...` (64 字元) |
| `ADMIN_HASH`     | 管理員密碼雜湊 | `abcdef123456...`           |
| `ADMIN_SALT`     | 密碼雜湊 Salt  | `xyz789abc123...` (32 字元) |

## 安全最佳實踐

### 🔑 密碼管理

- 使用長度至少 12 字元的強密碼
- 包含大小寫字母、數字和特殊字元
- 避免使用常見密碼或個人資訊
- 定期更換管理員密碼（建議每 90 天）

### 🛠️ 金鑰管理

- 使用真正的隨機數生成器產生金鑰
- 絕對不要將金鑰硬編碼在程式碼中
- 定期輪換加密金鑰（建議每年）
- 在多個安全位置備份金鑰

### 📱 雙因素認證

- 使用時間同步的 TOTP 應用程式
- 安全保存備用恢復碼
- 定期檢查 2FA 設定是否正常
- 考慮使用硬體安全金鑰作為額外保護

### 🔍 監控與審計

- 定期檢查審計日誌中的異常活動
- 監控失敗登入嘗試的模式
- 設定必要的警報機制
- 定期匯出和備份審計記錄

## 威脅模型

### 防護範圍

✅ **暴力破解攻擊**：速率限制和帳號鎖定
✅ **會話劫持**：指紋識別和加密會話
✅ **資料竊取**：加密儲存和傳輸
✅ **CSRF 攻擊**：隨機令牌驗證
✅ **重放攻擊**：時間戳和 nonce 驗證
✅ **程式碼分析**：混淆和保護措施

## 事件回應

### 安全事件處理流程

1. **檢測階段**

   - 監控審計日誌異常
   - 觀察登入失敗模式
   - 檢查會話異常行為

2. **回應階段**

   - 立即更換管理員密碼
   - 撤銷所有活動會話
   - 更新加密金鑰

3. **恢復階段**

   - 檢查資料完整性
   - 修復安全漏洞
   - 更新安全措施

4. **學習階段**
   - 分析攻擊方式
   - 改進防護機制
   - 更新安全文件

## 合規性

此安全實作符合以下標準的要求：

- 💼 **一般企業安全準則**
- 🔒 **資料保護最佳實踐**
- 🌐 **網頁應用程式安全標準**
- 📊 **審計追蹤要求**

## 聯絡資訊

如有安全疑慮或發現潛在漏洞，請聯絡：

- 📧 專案維護者
- 🐛 GitHub Issues
- 🔒 負責任的漏洞披露程序

---

**最後更新**：2025 年 9 月
**安全版本**：v2.0 (高安全性靜態部署版本)

⚠️ **重要提醒**：安全是一個持續的過程。請定期檢查和更新安全措施，保持警惕並遵循最佳實踐。
